{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.7", "generated_at": "2026-02-20T06:36:17.396501Z", "invocation_id": "463d33f9-245b-4636-8fb1-843110600c8b", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-20T06:36:12.981355Z", "completed_at": "2026-02-20T06:36:12.999334Z"}, {"name": "execute", "started_at": "2026-02-20T06:36:12.999334Z", "completed_at": "2026-02-20T06:36:15.301957Z"}], "thread_id": "Thread-1", "execution_time": 2.323265552520752, "adapter_response": {"_message": "SELECT 99", "code": "SELECT", "rows_affected": 99}, "message": "SELECT 99", "failures": null, "unique_id": "model.enpal_assessment_project.rep_sales_funnel_monthly", "compiled": true, "compiled_code": "/*\n    Model: rep_sales_funnel_monthly\n    \n    Purpose:\n        Monthly sales funnel report showing deal progression through 9 stage-based\n        steps. Aggregates deals by creation month cohort and counts how many reached\n        each funnel milestone.\n    \n    Grain: month \u00d7 funnel_step (one row per month per step)\n    \n    Columns:\n        - month: First day of month when deals were created\n        - kpi_name: Human-readable funnel step name\n        - funnel_step: Numeric step identifier (1-9)\n        - deals_count: Number of deals from this cohort that reached this step\n    \n    Design:\n        Uses a date spine to ensure all month \u00d7 step combinations exist, even when\n        counts are zero. This prevents gaps in time-series visualizations and ensures\n        report completeness.\n    \n    Note:\n        Activity-based sub-steps (2.1 Sales Call 1, 3.1 Sales Call 2) are included\n        but return zero counts due to documented data quality issues. See project EDA\n        for validation details.\n*/\n\n\nwith deals_base as (\n\n    select\n        creation_month,\n        stage_1_reached_at,\n        stage_2_reached_at,\n        stage_3_reached_at,\n        stage_4_reached_at,\n        stage_5_reached_at,\n        stage_6_reached_at,\n        stage_7_reached_at,\n        stage_8_reached_at,\n        stage_9_reached_at\n    \n    from \"postgres\".\"public_curated\".\"deals\"\n\n),\n\n-- Get all unique months from deals\nmonths_spine as (\n\n    select \n        distinct creation_month as month\n    \n    from deals_base\n\n),\n\n-- Define all funnel steps including activity-based sub-steps\nsteps_spine as (\n\n    select * from (\n        values\n            ('1', 'Lead Generation'),\n            ('2', 'Qualified Lead'),\n            ('2.1', 'Sales Call 1'),\n            ('3', 'Needs Assessment'),\n            ('3.1', 'Sales Call 2'),\n            ('4', 'Proposal/Quote Preparation'),\n            ('5', 'Negotiation'),\n            ('6', 'Closing'),\n            ('7', 'Implementation/Onboarding'),\n            ('8', 'Follow-up/Customer Success'),\n            ('9', 'Renewal/Expansion')\n    ) as t(funnel_step, kpi_name)\n\n),\n\n-- Create complete spine: every month \u00d7 every step\ncomplete_spine as (\n\n    select\n        months.month,\n        steps.funnel_step,\n        steps.kpi_name\n\n    from months_spine as months\n    \n    cross join steps_spine as steps\n\n),\n\n-- Calculate actual counts per step\nstep_counts as (\n\n    select\n        creation_month as month,\n        '1' as funnel_step,\n        count(case when stage_1_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '2' as funnel_step,\n        count(case when stage_2_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '3' as funnel_step,\n        count(case when stage_3_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '4' as funnel_step,\n        count(case when stage_4_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '5' as funnel_step,\n        count(case when stage_5_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '6' as funnel_step,\n        count(case when stage_6_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '7' as funnel_step,\n        count(case when stage_7_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '8' as funnel_step,\n        count(case when stage_8_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n    union all\n\n    select\n        creation_month as month,\n        '9' as funnel_step,\n        count(case when stage_9_reached_at is not null then 1 end) as deals_count\n    \n    from deals_base\n    group by creation_month\n\n),\n\nfinal as (\n\n    select\n        spine.month,\n        spine.kpi_name,\n        spine.funnel_step,\n        coalesce(counts.deals_count, 0) as deals_count\n    \n    from complete_spine as spine\n\n    left join step_counts as counts\n        on spine.month = counts.month\n        and spine.funnel_step = counts.funnel_step\n\n    order by spine.month, spine.funnel_step\n\n)\n\nselect * from final", "relation_name": "\"postgres\".\"public_marts\".\"rep_sales_funnel_monthly\""}], "elapsed_time": 21.54654312133789, "args": {"populate_cache": true, "defer": false, "invocation_command": "dbt run --select rep_sales_funnel_monthly", "partial_parse": true, "log_format": "default", "project_dir": "C:\\Users\\yashd\\Downloads\\dbt_enpal_assessment", "write_json": true, "indirect_selection": "eager", "require_explicit_package_overrides_for_builtin_materializations": true, "favor_state": false, "exclude": [], "printer_width": 80, "source_freshness_run_project_hooks": false, "introspect": true, "select": ["rep_sales_funnel_monthly"], "quiet": false, "strict_mode": false, "version_check": true, "static_parser": true, "log_format_file": "debug", "use_colors_file": true, "empty": false, "log_level": "info", "log_file_max_bytes": 10485760, "macro_debugging": false, "log_level_file": "debug", "cache_selected_only": false, "print": true, "log_path": "C:\\Users\\yashd\\Downloads\\dbt_enpal_assessment\\logs", "warn_error_options": {"include": [], "exclude": []}, "partial_parse_file_diff": true, "enable_legacy_logger": false, "profiles_dir": "C:\\Users\\yashd\\Downloads\\dbt_enpal_assessment", "which": "run", "require_resource_names_without_spaces": false, "use_colors": true, "vars": {}, "send_anonymous_usage_stats": true, "show_resource_report": false}}